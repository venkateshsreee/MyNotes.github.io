<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diwali Notes App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), 
                        url('https://images.unsplash.com/photo-1603383928972-0d6b0cac6dfb?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            display: flex;
            min-height: 80vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 350px;
            background: linear-gradient(135deg, #8B4513 0%, #D2691E 100%);
            padding: 25px;
            color: white;
            border-right: 3px solid #FFD700;
        }

        .sidebar-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        }

        .sidebar-header h2 {
            font-size: 24px;
            margin-bottom: 5px;
            color: #FFD700;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }

        .username-display {
            font-size: 18px;
            color: #FFF;
            font-weight: 600;
        }

        .search-container {
            margin-bottom: 20px;
        }

        .search-box {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .search-box:focus {
            outline: none;
            box-shadow: 0 2px 15px rgba(255, 215, 0, 0.5);
        }

        .notes-list-container {
            flex: 1;
            overflow-y: auto;
            max-height: 400px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
        }

        .notes-count {
            text-align: center;
            margin: 10px 0;
            font-size: 14px;
            color: #FFD700;
        }

        .notes-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .note-item {
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid #FFD700;
            color: #333;
        }

        .note-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .note-item.active {
            background: #FFD700;
            color: #8B4513;
            font-weight: 600;
        }

        .note-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .note-preview {
            color: #666;
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .note-date {
            font-size: 11px;
            color: #888;
            margin-top: 5px;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            padding: 30px;
            display: flex;
            flex-direction: column;
        }

        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .main-header h1 {
            color: #8B4513;
            font-size: 28px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        .logout-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .notes-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
        }

        .notes-controls button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .notes-controls button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .save-btn {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
        }

        .delete-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .add-btn {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }

        .change-password-btn {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
        }

        .note-editor {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .note-title-input {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.9);
        }

        .note-title-input:focus {
            outline: none;
            border-color: #8B4513;
        }

        textarea {
            flex: 1;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            resize: none;
            background: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
        }

        textarea:focus {
            outline: none;
            border-color: #8B4513;
        }

        .sync-status {
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
            color: #666;
            padding: 8px;
            background: rgba(255, 215, 0, 0.2);
            border-radius: 5px;
        }

        /* Diwali Decoration */
        .diwali-decoration {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            background: linear-gradient(90deg, #FFD700, #FF8C00, #FFD700);
            border-radius: 10px;
            color: #8B4513;
            font-weight: bold;
            font-size: 14px;
            animation: glow 2s infinite alternate;
        }

        @keyframes glow {
            from {
                box-shadow: 0 0 5px #FFD700;
            }
            to {
                box-shadow: 0 0 20px #FF8C00, 0 0 30px #FFD700;
            }
        }

        /* Login Page Styles */
        .login-container, .git-setup-container {
            padding: 40px;
            width: 100%;
        }

        .login-container {
            display: block;
        }

        .git-setup-container {
            display: none;
        }

        .notes-container {
            display: none;
            width: 100%;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus {
            border-color: #8B4513;
            outline: none;
        }

        button {
            padding: 12px;
            background: linear-gradient(135deg, #8B4513 0%, #D2691E 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .error-message {
            color: #e74c3c;
            text-align: center;
            margin-top: 10px;
            font-weight: 500;
            display: none;
        }

        /* Modal Styles */
        .password-modal, .note-name-modal, .git-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .password-modal-content, .note-name-modal-content, .git-modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .password-modal h2, .note-name-modal h2, .git-modal h2 {
            margin-bottom: 20px;
            text-align: center;
            color: #8B4513;
        }

        .password-modal-buttons, .note-name-modal-buttons, .git-modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .password-modal-buttons button, .note-name-modal-buttons button, .git-modal-buttons button {
            flex: 1;
        }

        .cancel-btn {
            background: #95a5a6;
        }

        .success-message {
            color: #2ecc71;
            text-align: center;
            margin-top: 10px;
            font-weight: 500;
            display: none;
        }

        .git-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                max-width: 100%;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 3px solid #FFD700;
            }
            
            .notes-list-container {
                max-height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Section -->
        <div class="login-container" id="loginContainer">
            <h1>🪔 Diwali Notes App</h1>
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Enter username">
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Enter password">
            </div>
            <button id="loginBtn">Login</button>
            <div class="error-message" id="loginError">Invalid username or password!</div>
            
            <div class="diwali-decoration">
                🪔 Happy Diwali! May this festival of lights bring joy to your life 🪔
            </div>
        </div>

        <!-- Git Setup Section -->
        <div class="git-setup-container" id="gitSetupContainer">
            <h1>GitHub Setup</h1>
            <div class="git-info">
                <p><strong>To store notes in Git, you need:</strong></p>
                <p>1. A GitHub account</p>
                <p>2. A personal access token with repo permissions</p>
                <p>3. A repository to store your notes</p>
            </div>
            <div class="form-group">
                <label for="githubToken">GitHub Personal Access Token</label>
                <input type="password" id="githubToken" placeholder="Enter your GitHub token">
            </div>
            <div class="form-group">
                <label for="repoName">Repository Name</label>
                <input type="text" id="repoName" placeholder="e.g., my-notes" value="my-notes">
            </div>
            <div class="form-group">
                <label for="repoOwner">Repository Owner (Username)</label>
                <input type="text" id="repoOwner" placeholder="Your GitHub username">
            </div>
            <button id="saveGitConfigBtn">Save GitHub Configuration</button>
            <div class="error-message" id="gitConfigError">Please fill all fields!</div>
        </div>

        <!-- Notes Section -->
        <div class="notes-container" id="notesContainer">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="sidebar-header">
                    <h2>🪔 Diwali Notes</h2>
                    <div class="username-display" id="usernameDisplay">ADMIN</div>
                </div>
                
                <div class="search-container">
                    <input type="text" class="search-box" id="searchBox" placeholder="Search notes...">
                </div>
                
                <div class="notes-count" id="notesCount">0 notes</div>
                
                <div class="notes-list-container">
                    <div class="notes-list" id="notesList">
                        <!-- Notes will be listed here -->
                    </div>
                </div>
                
                <div class="diwali-decoration">
                    Spread Joy &amp; Light 🌟
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="main-content">
                <div class="main-header">
                    <h1>Edit Note</h1>
                    <button class="logout-btn" id="logoutBtn">Logout</button>
                </div>
                
                <div class="sync-status" id="syncStatus">
                    <!-- Sync status will be shown here -->
                </div>
                
                <div class="notes-controls">
                    <button class="save-btn" id="saveBtn">Save</button>
                    <button class="delete-btn" id="deleteBtn">Delete Note</button>
                    <button class="add-btn" id="addBtn">Add New Note</button>
                    <button class="change-password-btn" id="changePasswordBtn">GitHub Settings</button>
                </div>
                
                <div class="note-editor">
                    <input type="text" class="note-title-input" id="noteTitle" placeholder="Note Title">
                    <textarea id="noteText" placeholder="Start typing your note here..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="password-modal" id="passwordModal">
        <div class="password-modal-content">
            <h2>Change Password</h2>
            <div class="form-group">
                <label for="currentPassword">Current Password</label>
                <input type="password" id="currentPassword" placeholder="Enter current password">
            </div>
            <div class="form-group">
                <label for="newPassword">New Password</label>
                <input type="password" id="newPassword" placeholder="Enter new password">
            </div>
            <div class="form-group">
                <label for="confirmPassword">Confirm New Password</label>
                <input type="password" id="confirmPassword" placeholder="Confirm new password">
            </div>
            <div class="error-message" id="passwordError">Passwords do not match or current password is incorrect!</div>
            <div class="success-message" id="passwordSuccess">Password changed successfully!</div>
            <div class="password-modal-buttons">
                <button class="cancel-btn" id="cancelPasswordChange">Cancel</button>
                <button id="confirmPasswordChange">Change Password</button>
            </div>
        </div>
    </div>

    <div class="note-name-modal" id="noteNameModal">
        <div class="note-name-modal-content">
            <h2>Name Your Note</h2>
            <div class="form-group">
                <label for="noteName">Note Name</label>
                <input type="text" id="noteName" placeholder="Enter note name">
            </div>
            <div class="error-message" id="noteNameError">Please enter a note name!</div>
            <div class="note-name-modal-buttons">
                <button class="cancel-btn" id="cancelNoteName">Cancel</button>
                    <button id="confirmNoteName">Create Note</button>
            </div>
        </div>
    </div>

    <div class="git-modal" id="gitModal">
        <div class="git-modal-content">
            <h2>GitHub Settings</h2>
            <div class="form-group">
                <label for="modalGithubToken">GitHub Personal Access Token</label>
                <input type="password" id="modalGithubToken" placeholder="Enter your GitHub token">
            </div>
            <div class="form-group">
                <label for="modalRepoName">Repository Name</label>
                <input type="text" id="modalRepoName" placeholder="e.g., my-notes">
            </div>
            <div class="form-group">
                <label for="modalRepoOwner">Repository Owner</label>
                <input type="text" id="modalRepoOwner" placeholder="Your GitHub username">
            </div>
            <div class="error-message" id="modalGitError">Please fill all fields!</div>
            <div class="success-message" id="modalGitSuccess">Settings updated successfully!</div>
            <div class="git-modal-buttons">
                <button class="cancel-btn" id="cancelGitConfig">Cancel</button>
                <button id="saveModalGitConfig">Save Settings</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const loginContainer = document.getElementById('loginContainer');
        const gitSetupContainer = document.getElementById('gitSetupContainer');
        const notesContainer = document.getElementById('notesContainer');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const loginBtn = document.getElementById('loginBtn');
        const loginError = document.getElementById('loginError');
        const logoutBtn = document.getElementById('logoutBtn');
        const saveBtn = document.getElementById('saveBtn');
        const deleteBtn = document.getElementById('deleteBtn');
        const addBtn = document.getElementById('addBtn');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        const noteText = document.getElementById('noteText');
        const noteTitle = document.getElementById('noteTitle');
        const notesList = document.getElementById('notesList');
        const usernameDisplay = document.getElementById('usernameDisplay');
        const syncStatus = document.getElementById('syncStatus');
        const searchBox = document.getElementById('searchBox');
        const notesCount = document.getElementById('notesCount');
        
        // GitHub config elements
        const githubTokenInput = document.getElementById('githubToken');
        const repoNameInput = document.getElementById('repoName');
        const repoOwnerInput = document.getElementById('repoOwner');
        const saveGitConfigBtn = document.getElementById('saveGitConfigBtn');
        const gitConfigError = document.getElementById('gitConfigError');
        
        // Modal elements
        const passwordModal = document.getElementById('passwordModal');
        const gitModal = document.getElementById('gitModal');
        const noteNameModal = document.getElementById('noteNameModal');

        // App State
        let notes = [];
        let currentNoteId = null;
        let currentUser = null;
        let gitConfig = null;
        let filteredNotes = [];

        // Hardcoded credentials
        const HARDCODED_USERNAME = 'ADMIN';
        const HARDCODED_PASSWORD = 'ADMIN';

        // Initialize the app
        function init() {
            // Check if user is already logged in
            const savedUser = localStorage.getItem('currentUser');
            const savedGitConfig = localStorage.getItem('gitConfig');
            
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                
                if (savedGitConfig) {
                    gitConfig = JSON.parse(savedGitConfig);
                    showNotesPage();
                } else {
                    showGitSetupPage();
                }
            } else {
                showLoginPage();
            }

            // Load notes from localStorage as cache
            const savedNotes = localStorage.getItem('notes');
            if (savedNotes) {
                notes = JSON.parse(savedNotes);
                filteredNotes = [...notes];
                renderNotesList();
                updateNotesCount();
            }

            // Event listeners
            loginBtn.addEventListener('click', handleLogin);
            logoutBtn.addEventListener('click', handleLogout);
            saveBtn.addEventListener('click', saveNote);
            deleteBtn.addEventListener('click', deleteNote);
            addBtn.addEventListener('click', showNoteNameModal);
            changePasswordBtn.addEventListener('click', showGitModal);
            saveGitConfigBtn.addEventListener('click', saveGitConfig);
            searchBox.addEventListener('input', handleSearch);
            noteTitle.addEventListener('input', updateNoteTitle);
            
            // Initialize modals
            initModals();
            
            // Load notes from GitHub if config exists
            if (gitConfig) {
                loadNotesFromGitHub();
            }
        }

        function initModals() {
            // Password modal
            document.getElementById('cancelPasswordChange').addEventListener('click', () => passwordModal.style.display = 'none');
            document.getElementById('confirmPasswordChange').addEventListener('click', changePassword);
            
            // Note name modal
            document.getElementById('cancelNoteName').addEventListener('click', hideNoteNameModal);
            document.getElementById('confirmNoteName').addEventListener('click', createNoteWithName);
            
            // Git modal
            document.getElementById('cancelGitConfig').addEventListener('click', () => gitModal.style.display = 'none');
            document.getElementById('saveModalGitConfig').addEventListener('click', saveModalGitConfig);
        }

        // Search functionality
        function handleSearch() {
            const searchTerm = searchBox.value.toLowerCase();
            
            if (searchTerm === '') {
                filteredNotes = [...notes];
            } else {
                filteredNotes = notes.filter(note => 
                    note.title.toLowerCase().includes(searchTerm) || 
                    note.content.toLowerCase().includes(searchTerm)
                );
            }
            
            renderNotesList();
            updateNotesCount();
        }

        // Update notes count
        function updateNotesCount() {
            const total = notes.length;
            const showing = filteredNotes.length;
            
            if (total === showing) {
                notesCount.textContent = `${total} note${total !== 1 ? 's' : ''}`;
            } else {
                notesCount.textContent = `${showing} of ${total} note${total !== 1 ? 's' : ''}`;
            }
        }

        // Update note title
        function updateNoteTitle() {
            if (!currentNoteId) return;
            
            const noteIndex = notes.findIndex(n => n.id === currentNoteId);
            if (noteIndex !== -1) {
                notes[noteIndex].title = noteTitle.value;
                renderNotesList();
            }
        }

        // Login functionality
        function handleLogin() {
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();

            if (username === HARDCODED_USERNAME && password === HARDCODED_PASSWORD) {
                currentUser = { username, password };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Check if GitHub config exists
                const savedGitConfig = localStorage.getItem('gitConfig');
                if (savedGitConfig) {
                    gitConfig = JSON.parse(savedGitConfig);
                    showNotesPage();
                    loadNotesFromGitHub();
                } else {
                    showGitSetupPage();
                }
                
                loginError.style.display = 'none';
            } else {
                loginError.style.display = 'block';
            }
        }

        // Logout functionality
        function handleLogout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            showLoginPage();
            usernameInput.value = '';
            passwordInput.value = '';
        }

        // Show pages
        function showLoginPage() {
            loginContainer.style.display = 'block';
            gitSetupContainer.style.display = 'none';
            notesContainer.style.display = 'none';
        }

        function showGitSetupPage() {
            loginContainer.style.display = 'none';
            gitSetupContainer.style.display = 'block';
            notesContainer.style.display = 'none';
        }

        function showNotesPage() {
            loginContainer.style.display = 'none';
            gitSetupContainer.style.display = 'none';
            notesContainer.style.display = 'flex';
            usernameDisplay.textContent = currentUser.username;
        }

        // GitHub Configuration
        function saveGitConfig() {
            const token = githubTokenInput.value.trim();
            const repoName = repoNameInput.value.trim();
            const repoOwner = repoOwnerInput.value.trim();
            
            if (!token || !repoName || !repoOwner) {
                gitConfigError.style.display = 'block';
                return;
            }
            
            gitConfig = { token, repoName, repoOwner };
            localStorage.setItem('gitConfig', JSON.stringify(gitConfig));
            gitConfigError.style.display = 'none';
            
            showNotesPage();
            loadNotesFromGitHub();
        }

        function saveModalGitConfig() {
            const token = document.getElementById('modalGithubToken').value.trim();
            const repoName = document.getElementById('modalRepoName').value.trim();
            const repoOwner = document.getElementById('modalRepoOwner').value.trim();
            
            if (!token || !repoName || !repoOwner) {
                document.getElementById('modalGitError').style.display = 'block';
                return;
            }
            
            gitConfig = { token, repoName, repoOwner };
            localStorage.setItem('gitConfig', JSON.stringify(gitConfig));
            
            document.getElementById('modalGitError').style.display = 'none';
            document.getElementById('modalGitSuccess').style.display = 'block';
            
            setTimeout(() => {
                gitModal.style.display = 'none';
                loadNotesFromGitHub();
            }, 1500);
        }

        // GitHub API Functions
        async function loadNotesFromGitHub() {
            if (!gitConfig) return;
            
            updateSyncStatus('Syncing with GitHub...');
            
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${gitConfig.repoOwner}/${gitConfig.repoName}/contents/notes.json`,
                    {
                        headers: {
                            'Authorization': `token ${gitConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    }
                );
                
                if (response.status === 404) {
                    // File doesn't exist yet, create initial notes file
                    await createInitialNotesFile();
                    return;
                }
                
                if (!response.ok) {
                    throw new Error(`GitHub API error: ${response.status}`);
                }
                
                const data = await response.json();
                const content = JSON.parse(atob(data.content));
                notes = content.notes || [];
                filteredNotes = [...notes];
                
                // Update local storage cache
                localStorage.setItem('notes', JSON.stringify(notes));
                
                renderNotesList();
                updateNotesCount();
                updateSyncStatus('Synced with GitHub');
                
            } catch (error) {
                console.error('Error loading notes from GitHub:', error);
                updateSyncStatus('Sync failed - using local cache');
            }
        }

        async function saveNotesToGitHub() {
            if (!gitConfig) return;
            
            updateSyncStatus('Saving to GitHub...');
            
            try {
                // First, get the current file to get its SHA (needed for update)
                let sha = null;
                try {
                    const getResponse = await fetch(
                        `https://api.github.com/repos/${gitConfig.repoOwner}/${gitConfig.repoName}/contents/notes.json`,
                        {
                            headers: {
                                'Authorization': `token ${gitConfig.token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        }
                    );
                    
                    if (getResponse.ok) {
                        const data = await getResponse.json();
                        sha = data.sha;
                    }
                } catch (error) {
                    // File might not exist yet, that's OK
                }
                
                const content = {
                    notes: notes,
                    lastUpdated: new Date().toISOString(),
                    updatedBy: currentUser.username
                };
                
                const response = await fetch(
                    `https://api.github.com/repos/${gitConfig.repoOwner}/${gitConfig.repoName}/contents/notes.json`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${gitConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: `Update notes - ${new Date().toLocaleString()}`,
                            content: btoa(JSON.stringify(content, null, 2)),
                            sha: sha
                        })
                    }
                );
                
                if (!response.ok) {
                    throw new Error(`GitHub API error: ${response.status}`);
                }
                
                // Update local storage cache
                localStorage.setItem('notes', JSON.stringify(notes));
                
                updateSyncStatus('Saved to GitHub');
                
            } catch (error) {
                console.error('Error saving notes to GitHub:', error);
                updateSyncStatus('Save failed - changes stored locally only');
            }
        }

        async function createInitialNotesFile() {
            if (!gitConfig) return;
            
            const content = {
                notes: [],
                created: new Date().toISOString(),
                createdBy: currentUser.username
            };
            
            try {
                const response = await fetch(
                    `https://api.github.com/repos/${gitConfig.repoOwner}/${gitConfig.repoName}/contents/notes.json`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${gitConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: 'Initial notes file',
                            content: btoa(JSON.stringify(content, null, 2))
                        })
                    }
                );
                
                if (!response.ok) {
                    throw new Error(`GitHub API error: ${response.status}`);
                }
                
                notes = [];
                filteredNotes = [];
                localStorage.setItem('notes', JSON.stringify(notes));
                renderNotesList();
                updateNotesCount();
                updateSyncStatus('Initialized notes repository');
                
            } catch (error) {
                console.error('Error creating initial notes file:', error);
                updateSyncStatus('Initialization failed');
            }
        }

        function updateSyncStatus(message) {
            syncStatus.textContent = message;
        }

        // Notes Management
        function renderNotesList() {
            notesList.innerHTML = '';
            
            if (filteredNotes.length === 0) {
                if (searchBox.value) {
                    notesList.innerHTML = '<div class="note-item" style="text-align: center; color: #666;">No notes match your search.</div>';
                } else {
                    notesList.innerHTML = '<div class="note-item" style="text-align: center; color: #666;">No notes yet. Click "Add New Note" to create one.</div>';
                }
                return;
            }
            
            filteredNotes.forEach(note => {
                const noteElement = document.createElement('div');
                noteElement.className = 'note-item';
                if (note.id === currentNoteId) {
                    noteElement.classList.add('active');
                }
                
                const date = new Date(note.lastModified || note.created);
                const formattedDate = date.toLocaleDateString();
                
                noteElement.innerHTML = `
                    <div class="note-title">${note.title || 'Untitled Note'}</div>
                    <div class="note-preview">${note.content.substring(0, 50)}${note.content.length > 50 ? '...' : ''}</div>
                    <div class="note-date">${formattedDate}</div>
                `;
                
                noteElement.addEventListener('click', () => selectNote(note.id));
                notesList.appendChild(noteElement);
            });
        }

        function selectNote(noteId) {
            currentNoteId = noteId;
            const note = notes.find(n => n.id === noteId);
            if (note) {
                noteTitle.value = note.title || '';
                noteText.value = note.content;
            }
            renderNotesList();
        }

        async function saveNote() {
            if (!currentNoteId) return;
            
            const noteIndex = notes.findIndex(n => n.id === currentNoteId);
            if (noteIndex !== -1) {
                notes[noteIndex].content = noteText.value;
                notes[noteIndex].title = noteTitle.value;
                notes[noteIndex].lastModified = new Date().toISOString();
                
                // Save to GitHub
                await saveNotesToGitHub();
                renderNotesList();
                updateNotesCount();
            }
        }

        function autoSaveNote() {
            if (currentNoteId) {
                clearTimeout(window.autoSaveTimeout);
                window.autoSaveTimeout = setTimeout(saveNote, 2000);
            }
        }

        async function deleteNote() {
            if (!currentNoteId) return;
            
            if (confirm('Are you sure you want to delete this note?')) {
                notes = notes.filter(n => n.id !== currentNoteId);
                filteredNotes = filteredNotes.filter(n => n.id !== currentNoteId);
                
                // Save to GitHub
                await saveNotesToGitHub();
                
                currentNoteId = null;
                noteTitle.value = '';
                noteText.value = '';
                renderNotesList();
                updateNotesCount();
            }
        }

        function showNoteNameModal() {
            noteNameModal.style.display = 'flex';
            document.getElementById('noteName').value = '';
            document.getElementById('noteNameError').style.display = 'none';
        }

        function hideNoteNameModal() {
            noteNameModal.style.display = 'none';
        }

        async function createNoteWithName() {
            const noteName = document.getElementById('noteName').value.trim();
            
            if (!noteName) {
                document.getElementById('noteNameError').style.display = 'block';
                return;
            }
            
            const newNote = {
                id: Date.now().toString(),
                title: noteName,
                content: '',
                created: new Date().toISOString(),
                lastModified: new Date().toISOString()
            };
            
            notes.push(newNote);
            filteredNotes.push(newNote);
            
            // Save to GitHub
            await saveNotesToGitHub();
            
            selectNote(newNote.id);
            renderNotesList();
            updateNotesCount();
            hideNoteNameModal();
            noteText.focus();
        }

        function showGitModal() {
            gitModal.style.display = 'flex';
            document.getElementById('modalGithubToken').value = gitConfig?.token || '';
            document.getElementById('modalRepoName').value = gitConfig?.repoName || '';
            document.getElementById('modalRepoOwner').value = gitConfig?.repoOwner || '';
            document.getElementById('modalGitError').style.display = 'none';
            document.getElementById('modalGitSuccess').style.display = 'none';
        }

        function changePassword() {
            // This is now just a demo function since we're using GitHub for storage
            document.getElementById('passwordSuccess').style.display = 'block';
            
            setTimeout(() => {
                passwordModal.style.display = 'none';
            }, 1500);
        }

        // Initialize the app when the page loads
        document.addEventListener('DOMContentLoaded', init);
        
        // Add event listener for auto-save
        noteText.addEventListener('input', autoSaveNote);
    </script>
</body>
</html>
